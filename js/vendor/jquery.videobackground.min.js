/*!
 * jQuery Video Background plugin
 * https://github.com/georgepaterson/jquery-videobackground
 *
 * Copyright 2012, George Paterson
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * Modify by William Huey
 *
 */

(function(e,t,n){"use strict";function r(){var t=e(n);var r=e(".video-background"),i=16,s=9,o=i/s,u,a,f,l=o*u,c=e("header"),h=c.height(),p=1280;var d=function(){r.css({width:"100%",height:"auto",left:"0px",marginTop:h+"px"})};var v=function(){r.css({height:u+"px",width:l+"px",left:f+"px",marginTop:h+"px"})};var m=function(){if(a<=p){if(a>=l){if(f/r.width()>=.2){d()}else{v()}}else{d()}}else{r.css({width:p+"px",height:"auto",left:(a-p)/2+"px",marginTop:h+"px"})}};t.on("resize.img",function(){u=t.height();a=t.width();h=c.height();u=u-h;l=o*u;f=(a-l)/2;m()});t.trigger("resize.img")}function i(t){e(t.controlbox).append(t.settings.preloadHtml);if(t.settings.preloadCallback){t.settings.preloadCallback.call(t)}}function s(t){var n=t.find("video").get(0),r;if(t.settings.controlPosition){r=e(t.settings.controlPosition).find(".ui-video-background-play a")}else{r=t.find(".ui-video-background-play a")}if(n.paused){n.play();r.toggleClass("ui-icon-pause ui-icon-play").text(t.settings.controlText[1])}else{if(n.ended){n.play();r.toggleClass("ui-icon-pause ui-icon-play").text(t.settings.controlText[1])}else{n.pause();r.toggleClass("ui-icon-pause ui-icon-play").text(t.settings.controlText[0])}}}function o(t){var n=t.find("video").get(0),r;if(t.settings.controlPosition){r=e(t.settings.controlPosition).find(".ui-video-background-mute a")}else{r=t.find(".ui-video-background-mute a")}if(n.volume===0){n.volume=1;r.toggleClass("ui-icon-volume-on ui-icon-volume-off").text(t.settings.controlText[2])}else{n.volume=0;r.toggleClass("ui-icon-volume-on ui-icon-volume-off").text(t.settings.controlText[3])}}function u(t){if(t.settings.resize){r()}t.controls.find(".ui-video-background-play a").on("click",function(e){e.preventDefault();s(t)});t.controls.find(".ui-video-background-mute a").on("click",function(e){e.preventDefault();o(t)});if(t.settings.loop){t.find("video").on("ended",function(){e(this).get(0).play();e(this).toggleClass("paused").text(t.settings.controlText[1])})}}function a(t){e(t.controlbox).html(t.controls);u(t);if(t.settings.loadedCallback){t.settings.loadedCallback.call(t)}}var f={init:function(n){return this.each(function(){var r=e(this),s="",o="",u=r.data("video-options"),f,l;if(t.createElement("video").canPlayType){r.settings=e.extend(true,{},e.fn.videobackground.defaults,u,n);if(!r.settings.initialised){r.settings.initialised=true;e.each(r.settings.videoSource,function(){l=Object.prototype.toString.call(this)==="[object Array]";if(l&&this[1]!==undefined){s=s+'<source src="'+this[0]+'" type="'+this[1]+'">'}else{if(l){s=s+'<source src="'+this[0]+'">'}else{s=s+'<source src="'+this+'">'}}});o=o+'preload="'+r.settings.preload+'"';if(r.settings.poster){o=o+' poster="'+r.settings.poster+'"'}if(r.settings.autoplay){o=o+' autoplay="autoplay"'}if(r.settings.loop){o=o+' loop="loop"'}e(r).html("<video "+o+">"+s+"</video>");r.controlbox=e('<div class="ui-video-background ui-widget ui-widget-content ui-corner-all"></div>');if(r.settings.controlPosition){e(r.settings.controlPosition).append(r.controlbox)}else{e(r).append(r.controlbox)}r.controls=e('<ul class="ui-video-background-controls"><li class="ui-video-background-play">'+'<a class="ui-icon ui-icon-pause" href="#">'+r.settings.controlText[1]+"</a>"+'</li><li class="ui-video-background-mute">'+'<a class="ui-icon ui-icon-volume-on" href="#">'+r.settings.controlText[2]+"</a>"+"</li></ul>");if(r.settings.preloadHtml||r.settings.preloadCallback){i(r);r.find("video").on("canplaythrough",function(){if(r.settings.autoplay){r.find("video").get(0).play()}a(r)})}else{r.find("video").on("canplaythrough",function(){if(r.settings.autoplay){r.find("video").get(0).play()}a(r)})}r.data("video-options",r.settings)}}else{r.settings=e.extend(true,{},e.fn.videobackground.defaults,u,n);if(!r.settings.initialised){r.settings.initialised=true;if(r.settings.poster){f=e('<img class="ui-video-background-poster" src="'+r.settings.poster+'">');r.append(f)}r.data("video-options",r.settings)}}})},play:function(t){return this.each(function(){var n=e(this),r=n.data("video-options");n.settings=e.extend(true,{},r,t);if(n.settings.initialised){s(n);n.data("video-options",n.settings)}})},mute:function(t){return this.each(function(){var n=e(this),r=n.data("video-options");n.settings=e.extend(true,{},r,t);if(n.settings.initialised){o(n);n.data("video-options",n.settings)}})},resize:function(t){return this.each(function(){var n=e(this),r=n.data("video-options");n.settings=e.extend(true,{},r,t);if(n.settings.initialised){n.data("video-options",n.settings)}})},destroy:function(r){return this.each(function(){var i=e(this),s=i.data("video-options");i.settings=e.extend(true,{},s,r);if(i.settings.initialised){i.settings.initialised=false;if(t.createElement("video").canPlayType){i.find("video").off("ended");if(i.settings.controlPosition){e(i.settings.controlPosition).find(".ui-video-background-mute a").off("click");e(i.settings.controlPosition).find(".ui-video-background-play a").off("click")}else{i.find(".ui-video-background-mute a").off("click");i.find(".ui-video-background-play a").off("click")}e(n).off("resize.img");i.find("video").off("canplaythrough");if(i.settings.controlPosition){e(i.settings.controlPosition).find(".ui-video-background").remove()}else{i.find(".ui-video-background").remove()}e("video",i).remove()}else{if(i.settings.poster){i.find(".ui-video-background-poster").remove()}}i.removeData("video-options")}})}};e.fn.videobackground=function(t){if(!this.length){return this}if(f[t]){return f[t].apply(this,Array.prototype.slice.call(arguments,1))}if(typeof t==="object"||!t){return f.init.apply(this,arguments)}e.error("Method "+t+" does not exist on jQuery.videobackground")};e.fn.videobackground.defaults={videoSource:[],poster:null,autoplay:true,preload:"none",loop:false,controlPosition:null,controlText:["Play","Pause","Mute","Unmute"],resize:true,preloadHtml:"",preloadCallback:null,loadedCallback:null,resizeTo:"document"}})(jQuery,document,window)
